{"version":3,"file":"recorder.mjs","sources":["../recorder.js"],"sourcesContent":["class Recorder {\n  constructor(options = {}) {\n    this.start = this.start.bind(this);\n    this.stop = this.stop.bind(this);\n    \n    this.onStop = this.onStop.bind(this);\n    this.onPause = this.onPause.bind(this);\n    this.onResume = this.onResume.bind(this);\n    this.addListeners = this.addListeners.bind(this);\n    \n    this.handleAudioChunks = this.handleAudioChunks.bind(this);\n    this.init = this.init.bind(this);\n    //this.state = this.state.bind(this);\n    \n    this.audioChunks = [];\n    this.mediaRecorder = null;\n    this.initPromise = null;\n  }\n\n  init() {\n    this.initPromise = navigator.mediaDevices\n      .getUserMedia({ audio: true })\n      .then(stream => {\n        this.mediaRecorder = new MediaRecorder(stream);\n        this.addListeners();\n        return this.mediaRecorder;\n      })\n      .catch(err => {\n        console.log(err.message);\n      });\n    return this.initPromise;\n  }\n\n  onStart() {\n    console.log('start')\n  }\n\n  onStop() {\n    console.log('stop')\n  }\n\n  onPause() {\n    console.log('pause')\n  }\n\n  onResume() {\n    console.log('resume')\n  }\n  \n  addListeners() {\n    this.mediaRecorder.addEventListener('dataavailable', this.handleAudioChunks);\n    this.mediaRecorder.addEventListener('start', this.onStart);\n    this.mediaRecorder.addEventListener('stop', this.onStop);\n    this.mediaRecorder.addEventListener('pause', this.onPause);\n    this.mediaRecorder.addEventListener('resume', this.onResume);\n  }\n\n  handleAudioChunks(event) {\n    this.audioChunks.push(event.data);\n  }\n\n  start() {\n    this.audioChunks = [];\n    if (!this.initPromise) {\n      return this.init()\n        .then(() => {\n          this.mediaRecorder.start();\n          return this.mediaRecorder;\n        });\n    } else {\n      return this.initPromise.then(() => {\n        this.mediaRecorder.start();\n        return this.mediaRecorder;\n      });\n    }\n  }\n\n  get state() {\n    return this.mediaRecorder ? this.mediaRecorder.state : 'inactive';\n  }\n\n  stop() {\n    return new Promise((resolve, reject) => {\n      this.mediaRecorder.addEventListener('stop', () => {\n          const audioBlob = new Blob(this.audioChunks);\n          const audioUrl = window.URL.createObjectURL(audioBlob);\n          const audio = new Audio(audioUrl);\n          const result = { audioBlob, audioUrl, audio };\n          resolve(result);\n      });\n      this.mediaRecorder.stop();\n    });\n  }\n}\nexport default Recorder"],"names":["Recorder","constructor","options","start","this","bind","stop","onStop","onPause","onResume","addListeners","handleAudioChunks","init","audioChunks","mediaRecorder","initPromise","navigator","mediaDevices","getUserMedia","then","stream","MediaRecorder","catch","err","log","message","onStart","console","addEventListener","event","push","data","prototypeAccessors","state","Promise","resolve","reject","audioBlob","Blob","audioUrl","window","URL","createObjectURL","audio","Audio"],"mappings":"AAAA,IAAMA,EACJC,SAAYC,kBAAU,SACfC,MAAQC,KAAKD,MAAME,KAAKD,WACxBE,KAAOF,KAAKE,KAAKD,KAAKD,WAEtBG,OAASH,KAAKG,OAAOF,KAAKD,WAC1BI,QAAUJ,KAAKI,QAAQH,KAAKD,WAC5BK,SAAWL,KAAKK,SAASJ,KAAKD,WAC9BM,aAAeN,KAAKM,aAAaL,KAAKD,WAEtCO,kBAAoBP,KAAKO,kBAAkBN,KAAKD,WAChDQ,KAAOR,KAAKQ,KAAKP,KAAKD,WAGtBS,YAAc,QACdC,cAAgB,UAChBC,YAAc,kCAGrBH,YAAAA,uCACOG,YAAcC,UAAUC,aAC1BC,aAAa,QAAS,IACtBC,cAAKC,YACCN,cAAgB,IAAIO,cAAcD,KAClCV,eACEN,EAAKU,gBAEbQ,eAAMC,WACGC,IAAID,EAAIE,WAEbrB,KAAKW,aAGdW,YAAAA,mBACEC,QAAQH,IAAI,UAGdjB,YAAAA,kBACEoB,QAAQH,IAAI,SAGdhB,YAAAA,mBACEmB,QAAQH,IAAI,UAGdf,YAAAA,oBACEkB,QAAQH,IAAI,WAGdd,YAAAA,6BACOI,cAAcc,iBAAiB,gBAAiBxB,KAAKO,wBACrDG,cAAcc,iBAAiB,QAASxB,KAAKsB,cAC7CZ,cAAcc,iBAAiB,OAAQxB,KAAKG,aAC5CO,cAAcc,iBAAiB,QAASxB,KAAKI,cAC7CM,cAAcc,iBAAiB,SAAUxB,KAAKK,WAGrDE,YAAAA,2BAAkBkB,QACXhB,YAAYiB,KAAKD,EAAME,OAG9B5B,YAAAA,wCACOU,YAAc,GACdT,KAAKW,YAODX,KAAKW,YAAYI,yBACjBL,cAAcX,QACZC,EAAKU,gBARPV,KAAKQ,OACTO,yBACML,cAAcX,QACZC,EAAKU,iBAUpBkB,EAAIC,4BACK7B,KAAKU,cAAgBV,KAAKU,cAAcmB,MAAQ,YAGzD3B,YAAAA,kCACS,IAAI4B,iBAASC,EAASC,KACtBtB,cAAcc,iBAAiB,sBAC1BS,EAAY,IAAIC,KAAKlC,EAAKS,aAC1B0B,EAAWC,OAAOC,IAAIC,gBAAgBL,GACtCM,EAAQ,IAAIC,MAAML,GAExBJ,EADe,WAAEE,WAAWE,QAAUI,QAGrC7B,cAAcR"}